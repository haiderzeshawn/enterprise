#!/bin/bash

# Logging all output to syslog
exec > >(logger -t fix-ownership) 2>&1

while true; do
    inotifywait -r -e create -e moved_to \
        --format '%w%f' \
        {% for dir in pg_db_directories -%}
        {{ dir }}{% if not loop.last %} {% endif %}
        {% endfor %} | while read -r FILE
    do
        [ -e "$FILE" ] && chown {{ postgres_user }}:{{ postgres_user }} "$FILE"
    done
    sleep 1
done

